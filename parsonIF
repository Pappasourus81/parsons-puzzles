<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Code Shuffler â€“ Conditionals (Hints & Insert)</title>
  <style>
    :root{
      --gap: 12px;
      --card-bg: #f8f9fb;
      --slot-border: #ccccd6;
      --ok: #d4f7d9;
      --bad: #ffd6d6;
      --accent: #0066cc;
      --hint-highlight: #e8f1ff;
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      margin: 18px;
      background: #ffffff;
      color:#111;
    }
    h1{ margin: 0 0 14px 0; font-size: 20px; }
    .controls{ display:flex; gap:8px; margin-top:12px; flex-wrap:wrap; align-items:center }
    button{
      background:var(--accent);
      color:white;
      border: none;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      font-size:14px;
    }
    button.secondary{ background:#666; }
    .layout{
      display: grid;
      grid-template-columns: 1fr;
      gap: 18px;
      align-items:start;
    }
    .panel{
      background:var(--card-bg);
      padding:12px;
      border-radius:10px;
      box-shadow: 0 2px 6px rgba(10,10,20,0.03);
    }
    .puzzle-box{
      margin:10px 0 12px 0;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid #d1d7df;
      background:#ffffff;
      box-shadow:0 1px 3px rgba(10,10,20,0.04);
      font-size:14px;
      font-weight:600;
      color:#222;
    }
    .scrambled-box{
      display:flex;
      flex-direction:column;
      gap:6px;
      padding:10px;
      border: 2px dashed var(--slot-border);
      min-height: 120px;
      border-radius:8px;
      background: #fff;
    }
    .piece{
      padding:8px 10px;
      background:white;
      border-radius:6px;
      box-shadow:0 1px 2px rgba(0,0,0,0.05);
      cursor:grab;
      user-select:none;
      white-space:pre-wrap;
      font-family: "Courier New", monospace;
      font-size: 13px;
      border:1px solid transparent;
      transition: transform 260ms ease, background-color 200ms ease, border-color 200ms ease, margin 260ms ease;
    }
    .piece.dragover{ outline:2px dashed #0066cc; }
    .piece.picked{ transform: scale(1.02); box-shadow:0 4px 10px rgba(0,0,0,0.08); }
    .slide-down { animation: slideDown 320ms ease; }
    .slide-up { animation: slideUp 320ms ease; }
    .hinted { background: var(--hint-highlight) !important; transition: background-color 800ms ease; }
    @keyframes slideDown {
      0% { transform: translateY(-18px); opacity:0.0; }
      60% { transform: translateY(6px); opacity:0.9; }
      100% { transform: translateY(0); opacity:1; }
    }
    @keyframes slideUp {
      0% { transform: translateY(18px); opacity:0.0; }
      60% { transform: translateY(-6px); opacity:0.9; }
      100% { transform: translateY(0); opacity:1; }
    }
    .message{ margin-top:10px; font-weight:600; }
    .meta{ font-size:14px; color:#444; margin-bottom:8px; }
  </style>
</head>
<body>
  <h1>Code Shuffler â€“ Conditionals</h1>
  <div class="meta">Drag lines to insert them. Drop a line onto another to insert at that position (lines below will shift). Submit to check.</div>

  <div class="puzzle-box" id="puzzleDescription">Select a puzzle to see its description.</div>

  <div class="layout">
    <div class="panel">
      <strong>Scrambled code (reorder here)</strong>
      <div id="scrambled" class="scrambled-box" aria-label="scrambled code lines"></div>
      <div class="controls">
        <button id="submitBtn">Submit</button>
        <button id="resetBtn" class="secondary">Reset (reshuffle)</button>
        <button id="nextBtn">New Puzzle</button>
        <button id="hintBtn" class="secondary">Hint (3)</button>
        <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
          <label style="font-size:13px; color:#333">Puzzle:
            <select id="puzzleSelect" style="margin-left:6px; padding:6px; border-radius:6px;"></select>
          </label>
        </div>
      </div>
      <div id="message" class="message" role="status"></div>
    </div>
  </div>

<script>
// Puzzle data (unchanged)
const puzzles = [...]; // omitted for brevity

let currentIndex = 0;
let currentOrder = [];
let hintLeft = 3;
const scrambledEl = document.getElementById('scrambled');
const messageEl = document.getElementById('message');
const puzzleSelect = document.getElementById('puzzleSelect');
const puzzleDescriptionEl = document.getElementById('puzzleDescription');
const hintBtn = document.getElementById('hintBtn');

function renderScrambled() {
  scrambledEl.innerHTML = '';
  currentOrder.forEach((line, idx) => {
    const el = document.createElement('div');
    el.className = 'piece';
    el.draggable = true;
    el.dataset.index = idx;
    el.dataset.line = line;
    el.textContent = line.trim();

    el.addEventListener('dragstart', (e) => {
      e.dataTransfer.setData('text/plain', idx);
      e.dataTransfer.effectAllowed = 'move';
      el.classList.add('picked');
    });
    el.addEventListener('dragend', () => el.classList.remove('picked'));
    el.addEventListener('dragover', (e) => { e.preventDefault(); el.classList.add('dragover'); });
    el.addEventListener('dragleave', () => el.classList.remove('dragover'));

    el.addEventListener('drop', (e) => {
      e.preventDefault(); el.classList.remove('dragover');
      const fromIdx = parseInt(e.dataTransfer.getData('text/plain'), 10);
      const toIdx = parseInt(el.dataset.index, 10);
      if (!Number.isNaN(fromIdx) && !Number.isNaN(toIdx) && fromIdx !== toIdx) {
        moveItemInsert(fromIdx, toIdx);
        renderScrambled();
        animateInsert(fromIdx, toIdx);
      }
    });

    el.addEventListener('click', () => {
      const prev = scrambledEl.querySelector('.picked');
      if (prev && prev !== el) {
        const i1 = parseInt(prev.dataset.index,10);
        const i2 = parseInt(el.dataset.index,10);
        moveItemInsert(i1, i2);
        prev.classList.remove('picked');
        renderScrambled();
        animateInsert(i1, i2);
      } else {
        scrambledEl.querySelectorAll('.picked').forEach(x=>x.classList.remove('picked'));
        el.classList.add('picked');
      }
    });
    scrambledEl.appendChild(el);
  });
}

function moveItemInsert(from, to) {
  const item = currentOrder.splice(from, 1)[0];
  currentOrder.splice(to, 0, item);
}

function animateInsert(from, to) {
  const children = Array.from(scrambledEl.children);
  children.forEach(c => { c.classList.remove('slide-down','slide-up'); });
  if (from > to) for (let i = to + 1; i <= from; i++) children[i]?.classList.add('slide-down');
  if (from < to) for (let i = from; i < to; i++) children[i]?.classList.add('slide-up');
}

function resetPuzzle() {
  const puzzle = puzzles[currentIndex];
  currentOrder = puzzle.lines.slice();
  shuffle(currentOrder);
  hintLeft = 3;
  hintBtn.textContent = `Hint (${hintLeft})`;
  renderScrambled();
  messageEl.textContent = '';
}

function submitPuzzle() {
  const puzzle = puzzles[currentIndex];
  const correct = puzzle.lines;
  let allCorrect = true;
  const pieces = Array.from(scrambledEl.children);
  pieces.forEach((p, i) => {
    p.style.background = '';
    p.style.borderColor = '';
    const text = p.dataset.line.trim();
    if (text === (correct[i] || '').trim()) {
      p.style.background = 'var(--ok)';
      p.style.borderColor = '#2a9a4a';
    } else {
      p.style.background = 'var(--bad)';
      p.style.borderColor = '#c44';
      allCorrect = false;
    }
  });
  messageEl.textContent = allCorrect ? 'All correct! Well done ðŸŽ‰' : 'Some lines are incorrect â€” incorrect lines are highlighted.';
  messageEl.style.color = allCorrect ? '#1a7f3a' : '#a00';
}

hintBtn.addEventListener('click', () => {
  if (hintLeft <= 0) return;
  const puzzle = puzzles[currentIndex];
  const correct = puzzle.lines;
  let targetIdx = -1;
  for (let i = 0; i < correct.length; i++) {
    if ((currentOrder[i] || '').trim() !== (correct[i] || '').trim()) { targetIdx = i; break; }
  }
  if (targetIdx === -1) return;
  const wantLine = correct[targetIdx].trim();
  const foundIdx = currentOrder.findIndex(x => x.trim() === wantLine);
  if (foundIdx !== -1) moveItemInsert(foundIdx, targetIdx);
  hintLeft--;
  hintBtn.textContent = `Hint (${hintLeft})`;
  renderScrambled();
  const children = Array.from(scrambledEl.children);
  const highlighted = children[targetIdx];
  if (highlighted) {
    highlighted.classList.add('hinted');
    setTimeout(()=>highlighted.classList.remove('hinted'),1500);
  }
  messageEl.textContent = `Hint used â€” placed one correct line. ${hintLeft} hint(s) left.`;
});
</script>
</body>
</html>
