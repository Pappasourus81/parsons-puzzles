<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Code Shuffler ‚Äì Syntax and Data Types</title>
<style>
  :root{
    --bg:#f6f8fb;
    --card:#ffffff;
    --accent:#0b66ff;
    --muted:#6b7280;
    --good:#d1fae5;
    --bad:#fee2e2;
    --bank-gap:8px;
    --shadow: 0 6px 18px rgba(13,30,60,0.08);
    --radius:12px;
  }
  html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Arial,sans-serif;background:linear-gradient(180deg,#f8fbff, #f6f8fb);}
  .wrap{max-width:980px;margin:28px auto;padding:20px;}
  header{display:flex;align-items:center;gap:16px;margin-bottom:16px}
  h1{font-size:20px;margin:0;color:#07203a}
  .meta{color:var(--muted);font-size:13px}
  .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;margin-bottom:16px}
  .description{background:linear-gradient(90deg,#ffffff,#fbfdff);border-radius:10px;padding:12px;border:1px solid #e6eefc}
  .pseudocode{
    font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace;
    background:#0f1724;color:#e6eefc;padding:12px;border-radius:8px;margin-top:12px;
    white-space:pre;line-height:1.6;display:block;
  }
  .line{display:block}
  .controls{display:flex;gap:8px;align-items:center;margin-top:12px}
  button{background:var(--accent);color:white;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600;box-shadow:0 6px 12px rgba(11,102,255,0.12)}
  button.secondary{background:#eef3ff;color:var(--accent);box-shadow:none}
  button:disabled{opacity:0.6;cursor:not-allowed}
  .bank{display:flex;flex-wrap:wrap;gap:var(--bank-gap);margin-top:12px}
  .token{display:inline-block;padding:8px 10px;border-radius:8px;background:#fff;border:1px solid #e6eefc;cursor:grab;box-shadow:0 4px 10px rgba(11,102,255,0.06);min-width:36px;text-align:center;color:#07203a}
  .token:active{cursor:grabbing}
  .token[draggable="true"]{user-select:none}
  .token.selected{box-shadow:0 6px 18px rgba(11,102,255,0.16);transform:translateY(-2px)}
  .blank{
    display:inline-block;min-width:64px;padding:6px 8px;border-radius:6px;
    background:rgba(255,255,255,0.06);border:1px dashed rgba(255,255,255,0.12);
    margin:0 4px;vertical-align:middle;color:#e6eefc;
  }
  .blank.empty{opacity:0.8}
  .blank.correct{background:var(--good);color:#064e3b;border-style:solid;border-color:#86efac}
  .blank.incorrect{background:var(--bad);color:#7f1d1d;border-style:solid;border-color:#fca5a5}
  .bank-wrap{margin-top:12px}
  .hint{color:var(--muted);font-size:13px;margin-top:8px}
  .status{margin-top:12px;font-weight:600}
  /* placed clone styling - fixes invisible token issue */
  .placed-clone{
    display:inline-block;
    padding:6px 8px;
    border-radius:6px;
    background:#ffffff;
    color:#07203a;               /* dark text for visibility */
    border:1px solid #e6eefc;
    box-shadow:0 4px 10px rgba(2,6,23,0.06);
    min-width:36px;
    text-align:center;
    font-weight:600;
  }
  /* focus outlines for accessibility */
  .token:focus, .blank:focus, button:focus, .placed-clone:focus {outline:3px solid rgba(11,102,255,0.12);outline-offset:3px}
  /* subtle animations */
  .token{transition:transform .12s ease, box-shadow .12s ease}
  .token:active{transform:scale(.98)}
  .token.to-bank{animation:pop .18s ease}
  @keyframes pop{0%{transform:scale(.85)}100%{transform:scale(1)}}
  /* responsive */
  @media (max-width:640px){
    .wrap{padding:12px}
    .token{padding:8px}
  }
  .sr-only{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
</style>
</head>
<body>
<div class="wrap" id="app">
  <header>
    <div>
      <h1>Code Shuffler ‚Äì Syntax and Data Types</h1>
      <div class="meta">Fill the numbered blanks using tokens from the bank. Drag or keyboard-place tokens. Tokens remain available and can be reused.</div>
    </div>
  </header>

  <section class="card" id="puzzleCard" aria-live="polite">
    <div id="puzzleMeta" class="description" role="region" aria-label="Puzzle description"></div>

    <pre class="pseudocode" id="codeArea" aria-label="Pseudocode area"></pre>

    <div class="bank-wrap card" aria-label="Token bank area">
      <div><strong>Token bank</strong></div>
      <div id="bank" class="bank" role="list" aria-label="Tokens available for placing"></div>
      <div class="hint">Tip: Use Tab to navigate tokens and blanks. Press Enter to pick/place. Tokens stay in the bank and can be used multiple times.</div>
    </div>

    <div class="controls" role="region" aria-label="Puzzle controls">
      <button id="submitBtn">Submit</button>
      <button id="resetBtn" class="secondary">Reset (reshuffle)</button>
      <button id="nextBtn" class="secondary">Next Puzzle</button>
      <div style="flex:1"></div>
      <div id="status" class="status" aria-live="polite"></div>
    </div>

    <div style="margin-top:12px;color:var(--muted);font-size:13px">
      <strong>Notes:</strong> This activity uses tokens and pseudocode style consistent with the IGCSE pseudocode guide (Topics 2 and 4). No loops or conditionals are used.
    </div>
  </section>

  <footer style="text-align:center;color:var(--muted);font-size:13px;margin-top:10px">
    <div>Made for classroom use ‚Äî single-file, static, embeddable in Google Sites.</div>
  </footer>
</div>

<script>
/* Puzzles (Topics 2 & 4). Edit the array to add/modify puzzles. */
const puzzles = [
  {
    title: "Simple output and quotes",
    description: "Expected: no input. Outputs the text Hello. Example output: Hello",
    lines: ["___1___ ___2___Hello___3___"],
    bank: ["OUTPUT", '"', "'", "PRINT", "OUTPUTS", "Hello", " "],
    answers: {"1":"OUTPUT","2":'"',"3":'"'}
  },
  {
    title: "Read and echo",
    description: "Input one word (a name). The program then outputs that name. Example: input Ali ‚Üí output Ali",
    lines: ["___1___ Name","___2___ Name"],
    bank: ["INPUT","OUTPUT","READ","PRINT","Name","Name:"],
    answers: {"1":"INPUT","2":"OUTPUT"}
  },
  {
    title: "Assignment and addition",
    description: "No input. Assign 5 to A then add 3 and store in B. Example final B = 8",
    lines: ["A ___1___ 5","B ___2___ A ___3___ 3"],
    bank: ["‚Üê","+","=","-","5","3","<-"],
    answers: {"1":"‚Üê","2":"‚Üê","3":"+"}
  },
  {
    title: "String and number concatenation",
    description: "Assume Name = \"Sam\" and Score = 10. Output should be: You scored 10. Example: You scored 10",
    lines: ["Name ___1___ \"Sam\"","Score ___2___ 10.0","___3___ \"You scored \" , ___4___"],
    bank: ["‚Üê", "=", "OUTPUT", "PRINT", "Score", "Name", "10.0"],
    answers: {"1":"‚Üê","2":"‚Üê","3":"OUTPUT","4":"Score"}
  },
  {
    title: "Char vs String literals",
    description: "Shows the difference between CHAR (single quotes) and STRING (double quotes). Outputs a char and a string.",
    lines: ["Letter ___1___ 'A'","Word ___2___ \"A\"","___3___ Letter , \" vs \" , Word"],
    bank: ["‚Üê","=","OUTPUT","PRINT","'","\"","Letter","Word"],
    answers: {"1":"‚Üê","2":"‚Üê","3":"OUTPUT"}
  },
  {
    title: "DIV and MOD usage",
    description: "Given Total = 17, compute how many full groups of 4 (GroupCount) and the remainder (Remainder). Example: GroupCount=4, Remainder=1",
    lines: ["Total ___1___ 17","GroupCount ___2___ Total ___3___ 4","Remainder ___4___ Total ___5___ 4"],
    bank: ["‚Üê","=","DIV","MOD","/","4","17"],
    answers: {"1":"‚Üê","2":"‚Üê","3":"DIV","4":"‚Üê","5":"MOD"}
  },
  {
    title: "SUBSTRING with indices",
    description: "INPUT Text. Output the substring from position 2 for length 3. Example: Text=\"Hello\" ‚Üí SUBSTRING(Text,2,3) returns \"ell\"",
    lines: ["INPUT Text","Part ___1___ SUBSTRING ___2___ Text ___3___ 2 ___4___ 3 ___5___","OUTPUT Part"],
    bank: ["‚Üê","SUBSTRING","(","Comma","Text",",",")","2","3"],
    answers: {"1":"‚Üê","2":"SUBSTRING","3":"(","4":",","5":")"}
  },
  {
    title: "Rounding REAL values",
    description: "Compute average of two REAL numbers and ROUND the result. Example: 4.7 and 3.2 ‚Üí average 3.95 ‚Üí ROUND(3.95) = 4",
    lines: ["A ___1___ 4.7","B ___2___ 3.2","Avg ___3___ ( A ___4___ B ) / 2.0","Result ___5___ ROUND ___6___ Avg ___7___"],
    bank: ["‚Üê","=","(","+",")","/","2.0","ROUND","Avg","A","B"],
    answers: {"1":"‚Üê","2":"‚Üê","3":"‚Üê","4":"+","5":"‚Üê","6":"ROUND","7":"Avg"}
  },
  {
    title: "OUTPUT multiple values with commas",
    description: "Given Name and Lives, output: Name, \" has \", Lives, \" lives\". Example: Ali has 3 lives",
    lines: ["Name ___1___ \"Ali\"","Lives ___2___ 3","___3___ Name ___4___ \" has \" ___5___ Lives ___6___ \" lives\" ___7___"],
    bank: ["‚Üê","=","OUTPUT",",","\" has \"","Lives","\" lives\"","Name"],
    answers: {"1":"‚Üê","2":"‚Üê","3":"OUTPUT","4":",","5":",","6":"Lives","7":","}
  },
  {
    title: "Complex expression with SUBSTRING, ROUND and arithmetic",
    description: "No user input. Extract digits, compute, and round. Example operations use parentheses, SUBSTRING and ROUND. This tests quotes, parentheses and punctuation.",
    lines: ["Text ___1___ \"X12Y\"","NumStr ___2___ SUBSTRING ___3___ Text ___4___ 2 ___5___ 2 ___6___","Num ___7___ NumStr ___8___"],
    bank: ["‚Üê","=","SUBSTRING","(","Text",",",")","2","2","NumStr","Num","INT","'","\""],
    answers: {"1":"‚Üê","2":"‚Üê","3":"SUBSTRING","4":"Text","5":"2","6":"2","7":"‚Üê","8":"NumStr"}
  }
];

let puzzleIndex = 0;
let selectedTokenValue = null;
const bankEl = document.getElementById('bank');
const codeArea = document.getElementById('codeArea');
const metaEl = document.getElementById('puzzleMeta');
const submitBtn = document.getElementById('submitBtn');
const resetBtn = document.getElementById('resetBtn');
const nextBtn = document.getElementById('nextBtn');
const statusEl = document.getElementById('status');

function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
function shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j = Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }
function clearSelection(){ document.querySelectorAll('.token.selected').forEach(el=>el.classList.remove('selected')); selectedTokenValue=null; }

/* Render puzzle */
function renderPuzzle(index){
  clearSelection();
  statusEl.textContent = '';
  const p = puzzles[index];
  metaEl.innerHTML = `<strong>${escapeHtml(p.title)}</strong><div style="margin-top:6px;color:${getComputedStyle(document.documentElement).getPropertyValue('--muted')}">${escapeHtml(p.description)}</div>`;
  let rendered = '';
  for(const line of p.lines){
    let out = escapeHtml(line);
    out = out.replace(/___(\d+)___/g, function(_,n){
      const id = `blank-${n}`;
      return `<span tabindex="0" role="button" aria-label="Blank ${n}" class="blank empty" data-blank="${n}" id="${id}">___${n}___</span>`;
    });
    rendered += '<span class="line">' + out + '</span>\n';
  }
  codeArea.innerHTML = rendered;

  // bank tokens (visual shuffle)
  bankEl.innerHTML = '';
  const bankTokens = shuffleArray(p.bank.slice());
  for(const t of bankTokens){
    const tokenEl = document.createElement('div');
    tokenEl.className = 'token';
    tokenEl.tabIndex = 0;
    tokenEl.setAttribute('role','listitem');
    tokenEl.setAttribute('draggable','true');
    tokenEl.dataset.value = t;
    tokenEl.title = t;
    tokenEl.innerHTML = `<span>${escapeHtml(String(t))}</span>`;
    attachBankTokenEvents(tokenEl);
    bankEl.appendChild(tokenEl);
  }

  document.querySelectorAll('.blank').forEach(b => attachBlankEvents(b));
}

/* Bank token events - originals remain in bank; we clone when placing */
function attachBankTokenEvents(tokenEl){
  tokenEl.addEventListener('dragstart', ev=>{
    ev.dataTransfer.setData('text/plain', tokenEl.dataset.value);
    ev.dataTransfer.effectAllowed = 'copy';
    tokenEl.classList.add('dragging');
    clearSelection();
    tokenEl.classList.add('selected');
    selectedTokenValue = tokenEl.dataset.value;
  });
  tokenEl.addEventListener('dragend', ev=>{
    tokenEl.classList.remove('dragging');
  });
  tokenEl.addEventListener('click', ev=>{
    const wasSelected = tokenEl.classList.contains('selected');
    clearSelection();
    if(!wasSelected){ tokenEl.classList.add('selected'); selectedTokenValue = tokenEl.dataset.value; }
  });
  tokenEl.addEventListener('keydown', ev=>{
    if(ev.key==='Enter' || ev.key===' '){ ev.preventDefault(); tokenEl.click(); }
  });
}

/* Blank events */
function attachBlankEvents(blankEl){
  blankEl.addEventListener('dragover', ev=>{ ev.preventDefault(); ev.dataTransfer.dropEffect='copy'; blankEl.classList.add('drag-over'); });
  blankEl.addEventListener('dragleave', ev=>{ blankEl.classList.remove('drag-over'); });
  blankEl.addEventListener('drop', ev=>{ ev.preventDefault(); blankEl.classList.remove('drag-over'); const val = ev.dataTransfer.getData('text/plain'); if(val) placeValueIntoBlankByValue(val, blankEl); });

  blankEl.addEventListener('keydown', ev=>{
    if(ev.key==='Enter' || ev.key===' '){ ev.preventDefault();
      if(selectedTokenValue !== null){ placeValueIntoBlankByValue(selectedTokenValue, blankEl); }
      else {
        const placed = getPlacedCloneInBlank(blankEl);
        if(placed){ placed.remove(); blankEl.innerHTML = `___${blankEl.dataset.blank}___`; blankEl.classList.add('empty'); attachBlankEvents(blankEl); }
      }
    }
  });

  blankEl.addEventListener('click', ev=>{
    if(selectedTokenValue !== null){
      placeValueIntoBlankByValue(selectedTokenValue, blankEl);
    } else {
      // if blank has a placed clone, focus it (user can press Enter to remove)
      const placed = getPlacedCloneInBlank(blankEl);
      if(placed) blankEl.focus();
    }
  });
}

function getPlacedCloneInBlank(blankEl){ return blankEl.querySelector('.placed-clone'); }

/* Place a clone with the token value into the blank (bank token remains available) */
function placeValueIntoBlankByValue(value, blankEl){
  const existing = getPlacedCloneInBlank(blankEl);
  if(existing) existing.remove();
  const clone = document.createElement('span');
  clone.className = 'placed-clone';
  clone.dataset.value = value;
  clone.tabIndex = -1;
  clone.innerHTML = `<span>${escapeHtml(String(value))}</span>`;
  // allow quick removal
  clone.addEventListener('click', ev=>{
    clone.remove();
    blankEl.innerHTML = `___${blankEl.dataset.blank}___`;
    blankEl.classList.add('empty');
    attachBlankEvents(blankEl);
  });
  blankEl.innerHTML = '';
  blankEl.appendChild(clone);
  blankEl.classList.remove('empty','correct','incorrect');
  clearSelection();
}

/* Validation */
function validateCurrent(){
  const p = puzzles[puzzleIndex];
  const answers = p.answers;
  let allCorrect = true;
  for(const key of Object.keys(answers)){
    const blank = document.querySelector(`[data-blank="${key}"]`);
    const expected = answers[key];
    const placed = getPlacedCloneInBlank(blank);
    const placedValue = placed ? placed.dataset.value : null;
    if(placedValue === expected){
      blank.classList.add('correct'); blank.classList.remove('incorrect','empty');
    } else {
      blank.classList.add('incorrect'); blank.classList.remove('correct');
      allCorrect = false;
    }
  }
  if(allCorrect){ statusEl.textContent = "All correct! Well done üéâ"; }
  else { statusEl.textContent = "Some blanks are incorrect ‚Äî incorrect blanks are highlighted red."; }
  return allCorrect;
}

/* Reset */
function resetPuzzle(){
  clearSelection();
  statusEl.textContent = '';
  // remove clones and restore placeholders
  document.querySelectorAll('.blank').forEach(b=>{
    const placed = getPlacedCloneInBlank(b);
    if(placed) placed.remove();
    b.innerHTML = `___${b.dataset.blank}___`;
    b.classList.add('empty');
    b.classList.remove('correct','incorrect');
    attachBlankEvents(b);
  });
  // reshuffle bank visually
  const p = puzzles[puzzleIndex];
  const tokens = p.bank.slice(); shuffleArray(tokens);
  bankEl.innerHTML = '';
  for(const t of tokens){
    const tokenEl = document.createElement('div');
    tokenEl.className = 'token';
    tokenEl.tabIndex = 0;
    tokenEl.setAttribute('role','listitem');
    tokenEl.setAttribute('draggable','true');
    tokenEl.dataset.value = t;
    tokenEl.title = t;
    tokenEl.innerHTML = `<span>${escapeHtml(String(t))}</span>`;
    attachBankTokenEvents(tokenEl);
    bankEl.appendChild(tokenEl);
  }
}

/* Next puzzle */
function nextPuzzle(){ puzzleIndex = (puzzleIndex + 1) % puzzles.length; renderPuzzle(puzzleIndex); }

/* Init */
renderPuzzle(puzzleIndex);

/* Buttons */
submitBtn.addEventListener('click', ()=>validateCurrent());
resetBtn.addEventListener('click', ()=>resetPuzzle());
nextBtn.addEventListener('click', ()=>nextPuzzle());
document.addEventListener('keydown', ev=>{ if(ev.key==='Escape') clearSelection(); });

/* accessibility: title updates */
const observer = new MutationObserver(()=>{ const p = puzzles[puzzleIndex]; document.title = `Code Shuffler ‚Äì ${p.title}`; });
observer.observe(metaEl,{childList:true,subtree:true});
</script>
</body>
</html>
